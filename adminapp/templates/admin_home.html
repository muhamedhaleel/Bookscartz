<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Bookscartz</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
    <!-- Navbar -->
    <nav class="bg-gray-800 text-white p-4">
        <div class="flex justify-between items-center">
            <h1 class="text-xl font-bold">Admin Panel</h1>
            <div class="flex space-x-4">
                <a href="{% url 'admin_dashboard' %}" class="hover:text-gray-300">Home</a>
                <a href="{% url 'admin_logout' %}" class="hover:text-gray-300">Logout</a>
            </div>
        </div>
    </nav>

    <!-- Layout Container -->
    <div class="flex min-h-screen">
        <!-- Sidebar -->
        <aside class="bg-gradient-to-r from-[#E5E7EB] to-[#d2b69b] text-black w-64 py-6 px-4 hidden lg:block">
            <nav class="space-y-6">
                <a href="{% url 'admin_dashboard' %}" class="flex items-center py-2 px-3 bg-white rounded-lg">Dashboard</a>
                <a href="{% url 'admin_products' %}" class="flex items-center py-2 px-3 hover:bg-white rounded-lg">Products</a>
                <a href="{% url 'category_list' %}" class="flex items-center py-2 px-3 hover:bg-white rounded-lg">Category</a>
                <a href="{% url 'brand_list' %}" class="flex items-center py-2 px-3 hover:bg-white rounded-lg">Publisher</a>
                <a href="{% url 'admin_customer' %}" class="flex items-center py-2 px-3 hover:bg-white rounded-lg">Customers</a>
                <a href="{% url 'admin_manage_orders' %}" class="flex items-center py-2 px-3 hover:bg-white rounded-lg">Orders</a>
                <a href="{% url 'offer_list' %}" class="flex items-center py-2 px-3 hover:bg-white rounded-lg">Offers</a>
                <a href="{% url 'coupon_list' %}" class="flex items-center py-2 px-3 hover:bg-white rounded-lg">Coupons</a>
                <a href="{% url 'admin_wallets' %}" class="flex items-center py-2 px-3 hover:bg-white rounded-lg">Wallets</a>
                
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-6">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <!-- Product Count Card -->
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-xl font-semibold mb-2">Total Products</h2>
                    <p class="text-3xl font-bold text-blue-600">{{ product_count|default:"0" }}</p>
                </div>

                <!-- Category Count Card -->
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-xl font-semibold mb-2">Total Categories</h2>
                    <p class="text-3xl font-bold text-green-600">{{ category_count|default:"0" }}</p>
                </div>

                <!-- Brand Count Card -->
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-xl font-semibold mb-2">Total Publishers</h2>
                    <p class="text-3xl font-bold text-purple-600">{{ brand_count|default:"0" }}</p>
                </div>

                <!-- Offers Count Card -->
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-xl font-semibold mb-2">Total Offers</h2>
                    <p class="text-3xl font-bold text-orange-600">{{ offer_count|default:"0" }}</p>
                </div>
            </div>

            <!-- Sales Analytics Section -->
            <div class="mt-8 grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Sales Chart -->
                <div class="bg-white rounded-lg shadow-md p-6 sales-analytics-card">
                    <div class="flex justify-between items-center mb-6">
                        <div class="relative">
                            <h2 class="text-2xl font-semibold sales-title">
                                Sales Analytics
                                <div class="sales-underline"></div>
                            </h2>
                            <p class="text-sm text-gray-500 mt-1">Track your sales performance</p>
                        </div>
                        <select id="chartPeriod" class="sales-select">
                            <option value="yearly">Yearly</option>
                            <option value="monthly">Monthly</option>
                            <option value="weekly">Weekly</option>
                            <option value="daily">Daily</option>
                        </select>
                    </div>
                    <div class="sales-chart-container">
                        <canvas id="salesChart"></canvas>
                        <div class="sales-info">
                            <div class="info-card">
                                <span class="info-label">Total Sales</span>
                                <span class="info-value" id="totalSalesValue">₹0</span>
                            </div>
                            <div class="info-card">
                                <span class="info-label">Average</span>
                                <span class="info-value" id="averageSalesValue">₹0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Top Products Chart -->
                <div class="bg-white rounded-lg shadow-md p-6 products-card">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-semibold text-gray-800 products-title">
                            Best Selling Products
                            <div class="products-underline"></div>
                        </h2>
                        <div class="bg-gray-100 rounded-full px-3 py-1 text-sm text-gray-600">
                            Top 10 Products
                        </div>
                    </div>
                    <div class="h-[400px] relative products-chart-container">
                        <canvas id="productsChart"></canvas>
                        <div class="absolute top-0 right-0 bg-white/80 rounded-lg p-2 text-xs text-gray-500 products-info">
                            Hover for details
                        </div>
                    </div>
                </div>
            </div>

            <!-- Categories and Publishers Analytics -->
            <div class="mt-6 grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Top Categories -->
                <div class="bg-white rounded-lg shadow-md p-4 category-card">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-xl font-semibold text-gray-800 category-title">
                            Top Categories
                            <div class="category-underline"></div>
                        </h2>
                        <div class="bg-gray-100 rounded-full px-2 py-1 text-xs text-gray-600">
                            Total: {{ category_count }}
                        </div>
                    </div>
                    <div class="h-[300px] relative category-chart-container">
                        <canvas id="categoriesChart"></canvas>
                        <div class="absolute top-0 right-0 bg-white/80 rounded-lg p-2 text-xs text-gray-500 category-info">
                            Click segments for details
                        </div>
                    </div>
                </div>

                <!-- Top Publishers -->
                <div class="bg-white rounded-lg shadow-md p-4 publisher-card">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-xl font-semibold text-gray-800 publisher-title">
                            Top Publishers
                            <div class="publisher-underline"></div>
                        </h2>
                        <div class="bg-gray-100 rounded-full px-2 py-1 text-xs text-gray-600">
                            Total: {{ brand_count }}
                        </div>
                    </div>
                    <div class="h-[300px] relative publisher-chart-container">
                        <canvas id="publishersChart"></canvas>
                        <div class="absolute top-0 right-0 bg-white/80 rounded-lg p-2 text-xs text-gray-500 publisher-info">
                            Click segments for details
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sales Report Section -->
            <div class="mt-8 bg-white rounded-lg shadow-md p-6">
                <h2 class="text-2xl font-semibold mb-6">Sales Report</h2>
                
                <!-- Report Filters -->
                <div class="flex flex-wrap gap-4 mb-6">
                    <div class="flex-1 min-w-[200px]">
                        <select id="reportType" class="w-full p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#A79277]">
                            <option value="daily">Today's Report</option>
                            <option value="weekly">Last 7 Days</option>
                            <option value="monthly">Last 30 Days</option>
                            <option value="custom">Custom Date Range</option>
                        </select>
                    </div>
                    
                    <!-- Custom Date Range -->
                    <div id="customDateRange" class="flex-1 min-w-[300px] hidden">
                        <div class="flex gap-2">
                            <input type="date" id="startDate" class="flex-1 p-2 border rounded-lg">
                            <input type="date" id="endDate" class="flex-1 p-2 border rounded-lg">
                        </div>
                    </div>
                    
                    <button onclick="generateReport()" class="bg-[#A79277] text-white px-6 py-2 rounded-lg hover:bg-[#8B7355]">
                        Generate Report
                    </button>
                    <button onclick="downloadReport()" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700">
                        Download PDF
                    </button>
                </div>

                <!-- Summary Cards -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h3 class="text-lg font-semibold mb-2">Total Orders</h3>
                        <p id="totalOrders" class="text-2xl font-bold">0</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h3 class="text-lg font-semibold mb-2">Total Sales</h3>
                        <p id="totalSales" class="text-2xl font-bold">₹0</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h3 class="text-lg font-semibold mb-2">Total Discounts</h3>
                        <p id="totalDiscounts" class="text-2xl font-bold">₹0</p>
                    </div>
                </div>

                <!-- Sales Report Table -->
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse">
                        <thead>
                            <tr class="bg-gray-100 border-b-2 border-gray-200">
                                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">Order ID</th>
                                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">Date</th>
                                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">Customer</th>
                                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">Items</th>
                                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">Payment Method</th>
                                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">Status</th>
                                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">Gross Amount</th>
                                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">Discounts</th>
                                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">Net Amount</th>
                            </tr>
                        </thead>
                        <tbody id="reportData">
                            <!-- Report data will be populated here -->
                        </tbody>
                        <tfoot>
                            <tr class="bg-gray-50 font-semibold border-t-2 border-gray-200">
                                <td colspan="6" class="px-6 py-4 text-right text-sm text-gray-700">Totals:</td>
                                <td class="px-6 py-4 text-sm text-gray-700" id="totalGrossAmount">₹0</td>
                                <td class="px-6 py-4 text-sm text-gray-700" id="totalDiscounts">₹0</td>
                                <td class="px-6 py-4 text-sm text-gray-700" id="totalNetAmount">₹0</td>
                            </tr>
                        </tfoot>
                    </table>
                </div>

                <!-- After the table, add pagination controls -->
                <div class="mt-4 flex items-center justify-between">
                    <div class="text-sm text-gray-700">
                        Showing <span id="itemsRange" class="font-medium">0-0</span> of <span id="totalItems" class="font-medium">0</span> orders
                    </div>
                    <div class="flex items-center space-x-2">
                        <button id="prevPage" class="px-3 py-1 border rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
                            Previous
                        </button>
                        <span id="pageInfo" class="px-3 py-1">Page <span id="currentPage">1</span> of <span id="totalPages">1</span></span>
                        <button id="nextPage" class="px-3 py-1 border rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
                            Next
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white text-center py-4 mt-8">
        © 2025 Bookscartz. All rights reserved.
    </footer>

    <!-- Add Chart.js before closing body tag -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // Initialize all charts when the document is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Fetch initial data and create charts
            fetchSalesData('yearly');
            fetchTopProducts();
            fetchTopCategories();
            fetchTopPublishers();

            // Add event listener for chart period changes
            document.getElementById('chartPeriod').addEventListener('change', function() {
                fetchSalesData(this.value);
            });
        });

        function fetchSalesData(period) {
            fetch(`/api/sales-analytics/?period=${period}`, {
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}'
                }
            })
            .then(response => response.json())
            .then(data => {
                createSalesChart(data);
            })
            .catch(error => console.error('Error:', error));
        }

        function createSalesChart(data) {
            const ctx = document.getElementById('salesChart').getContext('2d');
            
            // Calculate total and average sales
            const total = data.values.reduce((a, b) => a + b, 0);
            const average = total / data.values.length;
            
            // Update info cards
            document.getElementById('totalSalesValue').textContent = '₹' + total.toLocaleString();
            document.getElementById('averageSalesValue').textContent = '₹' + average.toLocaleString();
            
            // Destroy existing chart if it exists
            if (window.salesChart instanceof Chart) {
                window.salesChart.destroy();
            }

            window.salesChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.labels,
                    datasets: [{
                        label: 'Sales Amount',
                        data: data.values,
                        borderColor: '#A79277',
                        backgroundColor: 'rgba(167, 146, 119, 0.1)',
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#ffffff',
                        pointBorderColor: '#A79277',
                        pointBorderWidth: 2,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(255, 255, 255, 0.95)',
                            titleColor: '#2d3748',
                            bodyColor: '#4a5568',
                            borderColor: '#A79277',
                            borderWidth: 1,
                            padding: 12,
                            displayColors: false,
                            callbacks: {
                                label: function(context) {
                                    return '₹' + context.raw.toLocaleString();
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(167, 146, 119, 0.1)',
                                drawBorder: false
                            },
                            ticks: {
                                callback: function(value) {
                                    return '₹' + value.toLocaleString();
                                },
                                font: {
                                    size: 12
                                },
                                color: '#4a5568'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                font: {
                                    size: 12
                                },
                                color: '#4a5568'
                            }
                        }
                    }
                }
            });
        }

        function fetchTopProducts() {
            fetch('/api/top-products/', {
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}'
                }
            })
            .then(response => response.json())
            .then(data => {
                createTopProductsChart(data);
            })
            .catch(error => console.error('Error:', error));
        }

        function createTopProductsChart(data) {
            const ctx = document.getElementById('productsChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.labels.map(label => {
                        // Truncate long product names and add ellipsis
                        return label.length > 20 ? label.substring(0, 20) + '...' : label;
                    }),
                    datasets: [{
                        label: 'Units Sold',
                        data: data.values,
                        backgroundColor: [
                            '#A79277',
                            '#8B7355',
                            '#6B5736',
                            '#4C3D27',
                            '#2E2518',
                            '#C4B5A3',
                            '#D8CEC2',
                            '#EBE5DE'
                        ],
                        borderColor: '#ffffff',
                        borderWidth: 2,
                        borderRadius: 8,
                        maxBarThickness: 40,
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y', // This makes it a horizontal bar chart
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(255, 255, 255, 0.95)',
                            titleColor: '#2d3748',
                            bodyColor: '#4a5568',
                            borderColor: '#A79277',
                            borderWidth: 1,
                            padding: 12,
                            displayColors: true,
                            callbacks: {
                                title: function(context) {
                                    // Show full product name in tooltip
                                    return data.labels[context[0].dataIndex];
                                },
                                label: function(context) {
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b);
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return ` Sales: ${value} units (${percentage}% of total)`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                font: {
                                    family: "'Inter', sans-serif",
                                    size: 12
                                },
                                color: '#4a5568',
                                callback: function(value, index) {
                                    const label = data.labels[index];
                                    // Truncate long names for the axis labels
                                    return label.length > 25 ? label.substring(0, 25) + '...' : label;
                                }
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(167, 146, 119, 0.1)',
                                drawBorder: false
                            },
                            ticks: {
                                font: {
                                    family: "'Inter', sans-serif",
                                    size: 12
                                },
                                color: '#4a5568'
                            }
                        }
                    },
                    animation: {
                        duration: 1000,
                        easing: 'easeInOutQuart'
                    },
                    layout: {
                        padding: {
                            right: 10
                        }
                    }
                }
            });
        }

        function fetchTopCategories() {
            fetch('/api/top-categories/', {
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}'
                }
            })
            .then(response => response.json())
            .then(data => {
                createTopCategoriesChart(data);
            })
            .catch(error => console.error('Error:', error));
        }

        function createTopCategoriesChart(data) {
            const ctx = document.getElementById('categoriesChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: data.labels,
                    datasets: [{
                        data: data.values,
                        backgroundColor: [
                            '#A79277',
                            '#8B7355',
                            '#6B5736',
                            '#4C3D27',
                            '#2E2518',
                            '#C4B5A3',
                            '#D8CEC2',
                            '#EBE5DE'
                        ],
                        borderWidth: 2,
                        borderColor: '#ffffff',
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                padding: 10,
                                font: {
                                    size: 11,
                                    family: "'Inter', sans-serif"
                                },
                                boxWidth: 15,
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(255, 255, 255, 0.95)',
                            titleColor: '#2d3748',
                            bodyColor: '#4a5568',
                            borderColor: '#A79277',
                            borderWidth: 1,
                            padding: 12,
                            displayColors: true,
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const percentage = ((value / context.dataset.data.reduce((a, b) => a + b)) * 100).toFixed(1);
                                    return ` ${label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    },
                    animation: {
                        animateScale: true,
                        animateRotate: true
                    },
                    cutout: '60%'
                }
            });
        }

        function fetchTopPublishers() {
            fetch('/api/top-publishers/', {
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}'
                }
            })
            .then(response => response.json())
            .then(data => {
                createTopPublishersChart(data);
            })
            .catch(error => console.error('Error:', error));
        }

        function createTopPublishersChart(data) {
            const ctx = document.getElementById('publishersChart').getContext('2d');
            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: data.labels,
                    datasets: [{
                        data: data.values,
                        backgroundColor: [
                            '#A79277',
                            '#8B7355',
                            '#6B5736',
                            '#4C3D27',
                            '#2E2518',
                            '#C4B5A3',
                            '#D8CEC2',
                            '#EBE5DE'
                        ],
                        borderWidth: 2,
                        borderColor: '#ffffff',
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                padding: 10,
                                font: {
                                    size: 11,
                                    family: "'Inter', sans-serif"
                                },
                                boxWidth: 15,
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(255, 255, 255, 0.95)',
                            titleColor: '#2d3748',
                            bodyColor: '#4a5568',
                            borderColor: '#A79277',
                            borderWidth: 1,
                            padding: 12,
                            displayColors: true,
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const percentage = ((value / context.dataset.data.reduce((a, b) => a + b)) * 100).toFixed(1);
                                    return ` ${label}: ${value} books (${percentage}%)`;
                                }
                            }
                        }
                    },
                    animation: {
                        animateScale: true,
                        animateRotate: true,
                        duration: 1000,
                        easing: 'easeInOutQuart'
                    }
                }
            });
        }

        let currentPageNumber = 1;

        function generateReport() {
            const reportType = document.getElementById('reportType').value;
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;

            // Prepare data for API call
            const data = {
                report_type: reportType,
                start_date: startDate,
                end_date: endDate,
                page: currentPageNumber
            };

            // Make API call
            fetch('/api/sales-report/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    updateReportDisplay(data);
                    updatePagination(data.pagination);
                } else {
                    alert('Error: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error generating report');
            });
        }

        function updateReportDisplay(data) {
            // Update summary cards
            document.getElementById('totalOrders').textContent = data.summary.total_orders;
            document.getElementById('totalSales').textContent = '₹' + data.summary.total_sales.toFixed(2);
            document.getElementById('totalDiscounts').textContent = '₹' + data.summary.total_discounts.toFixed(2);

            // Update table
            const tbody = document.getElementById('reportData');
            tbody.innerHTML = '';

            let totalGrossAmount = 0;
            let totalDiscounts = 0;
            let totalNetAmount = 0;

            data.orders.forEach((order, index) => {
                const row = document.createElement('tr');
                row.className = `${index % 2 === 0 ? 'bg-white' : 'bg-gray-50'} hover:bg-gray-100 transition-colors duration-150 ease-in-out`;
                
                // Calculate values
                const grossAmount = parseFloat(order.gross_amount);
                const discounts = parseFloat(order.discounts);
                const netAmount = parseFloat(order.net_amount);
                
                // Update totals
                totalGrossAmount += grossAmount;
                totalDiscounts += discounts;
                totalNetAmount += netAmount;

                row.innerHTML = `
                    <td class="px-6 py-4 text-sm text-gray-700 border-b">#${order.order_id}</td>
                    <td class="px-6 py-4 text-sm text-gray-700 border-b whitespace-nowrap">${order.date}</td>
                    <td class="px-6 py-4 text-sm text-gray-700 border-b">${order.customer_name}</td>
                    <td class="px-6 py-4 text-sm text-gray-700 border-b text-center">${order.items_count}</td>
                    <td class="px-6 py-4 text-sm text-gray-700 border-b">${order.payment_method}</td>
                    <td class="px-6 py-4 text-sm border-b">
                        <span class="px-3 py-1 rounded-full text-xs font-medium ${getStatusClass(order.status)}">
                            ${order.status}
                        </span>
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-700 border-b">₹${grossAmount.toFixed(2)}</td>
                    <td class="px-6 py-4 text-sm text-gray-700 border-b">₹${discounts.toFixed(2)}</td>
                    <td class="px-6 py-4 text-sm text-gray-700 border-b">₹${netAmount.toFixed(2)}</td>
                `;
                tbody.appendChild(row);
            });

            // Update footer totals
            document.getElementById('totalGrossAmount').textContent = `₹${totalGrossAmount.toFixed(2)}`;
            document.getElementById('totalDiscounts').textContent = `₹${totalDiscounts.toFixed(2)}`;
            document.getElementById('totalNetAmount').textContent = `₹${totalNetAmount.toFixed(2)}`;
        }

        function getStatusClass(status) {
            const statusClasses = {
                'pending': 'bg-yellow-100 text-yellow-800',
                'processing': 'bg-blue-100 text-blue-800',
                'shipped': 'bg-purple-100 text-purple-800',
                'delivered': 'bg-green-100 text-green-800',
                'cancelled': 'bg-red-100 text-red-800',
                'returned': 'bg-gray-100 text-gray-800'
            };
            return statusClasses[status.toLowerCase()] || 'bg-gray-100 text-gray-800';
        }

        function updatePagination(pagination) {
            const { current_page, total_pages, has_next, has_previous, total_items } = pagination;
            const itemsPerPage = 10;
            
            // Update page info
            document.getElementById('currentPage').textContent = current_page;
            document.getElementById('totalPages').textContent = total_pages;
            
            // Update items range
            const start = ((current_page - 1) * itemsPerPage) + 1;
            const end = Math.min(start + itemsPerPage - 1, total_items);
            document.getElementById('itemsRange').textContent = `${start}-${end}`;
            document.getElementById('totalItems').textContent = total_items;
            
            // Update button states
            document.getElementById('prevPage').disabled = !has_previous;
            document.getElementById('nextPage').disabled = !has_next;
        }

        // Add event listeners for pagination buttons
        document.getElementById('prevPage').addEventListener('click', () => {
            if (currentPageNumber > 1) {
                currentPageNumber--;
                generateReport();
            }
        });

        document.getElementById('nextPage').addEventListener('click', () => {
            currentPageNumber++;
            generateReport();
        });

        // Update the report type change handler
        document.getElementById('reportType').addEventListener('change', () => {
            currentPageNumber = 1; // Reset to first page when changing report type
            generateReport();
        });

        // Initialize with daily report on page load
        window.onload = function() {
            currentPageNumber = 1;
            generateReport();
        };

        function downloadReport() {
            const reportType = document.getElementById('reportType').value;
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;

            // Create query parameters
            const params = new URLSearchParams({
                report_type: reportType,
                start_date: startDate,
                end_date: endDate
            });

            // Download the PDF
            window.location.href = `/download-sales-report/?${params.toString()}`;
        }
    </script>

    <style>
        .category-card {
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            transition: all 0.3s ease;
            border: 1px solid rgba(167, 146, 119, 0.1);
        }

        .category-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(167, 146, 119, 0.15);
        }

        .category-title {
            position: relative;
            display: inline-block;
            background: linear-gradient(to right, #2d3748, #4a5568);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .category-underline {
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(to right, #A79277, #8B7355);
            transform: scaleX(0);
            transition: transform 0.3s ease;
            transform-origin: left;
        }

        .category-card:hover .category-underline {
            transform: scaleX(1);
        }

        .category-chart-container {
            position: relative;
            padding: 1rem;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(8px);
        }

        .category-info {
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .category-card:hover .category-info {
            opacity: 1;
        }

        @media (max-width: 768px) {
            .category-card {
                padding: 1rem;
            }
            
            .category-chart-container {
                height: 300px;
            }
        }

        .products-card {
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            transition: all 0.3s ease;
            border: 1px solid rgba(167, 146, 119, 0.1);
        }

        .products-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(167, 146, 119, 0.15);
        }

        .products-title {
            position: relative;
            display: inline-block;
            background: linear-gradient(to right, #2d3748, #4a5568);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .products-underline {
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(to right, #A79277, #8B7355);
            transform: scaleX(0);
            transition: transform 0.3s ease;
            transform-origin: left;
        }

        .products-card:hover .products-underline {
            transform: scaleX(1);
        }

        .products-chart-container {
            position: relative;
            padding: 1rem;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(8px);
        }

        .products-info {
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .products-card:hover .products-info {
            opacity: 1;
        }

        @media (max-width: 768px) {
            .products-card {
                padding: 1rem;
            }
            
            .products-chart-container {
                height: 300px;
            }
        }

        .publisher-card {
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            transition: all 0.3s ease;
            border: 1px solid rgba(167, 146, 119, 0.1);
        }

        .publisher-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(167, 146, 119, 0.15);
        }

        .publisher-title {
            position: relative;
            display: inline-block;
            background: linear-gradient(to right, #2d3748, #4a5568);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .publisher-underline {
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(to right, #A79277, #8B7355);
            transform: scaleX(0);
            transition: transform 0.3s ease;
            transform-origin: left;
        }

        .publisher-card:hover .publisher-underline {
            transform: scaleX(1);
        }

        .publisher-chart-container {
            position: relative;
            padding: 1rem;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(8px);
        }

        .publisher-info {
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .publisher-card:hover .publisher-info {
            opacity: 1;
        }

        @media (max-width: 768px) {
            .publisher-card {
                padding: 1rem;
            }
            
            .publisher-chart-container {
                height: 300px;
            }
        }

        /* Sales Analytics Styles */
        .sales-analytics-card {
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            transition: all 0.3s ease;
            border: 1px solid rgba(167, 146, 119, 0.1);
            position: relative;
            overflow: hidden;
        }

        .sales-analytics-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(167, 146, 119, 0.15);
        }

        .sales-title {
            position: relative;
            display: inline-block;
            background: linear-gradient(to right, #2d3748, #4a5568);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 600;
        }

        .sales-underline {
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(to right, #A79277, #8B7355);
            transform: scaleX(0);
            transition: transform 0.3s ease;
            transform-origin: left;
        }

        .sales-analytics-card:hover .sales-underline {
            transform: scaleX(1);
        }

        .sales-select {
            padding: 0.5rem 2rem 0.5rem 1rem;
            border: 1px solid #A79277;
            border-radius: 0.5rem;
            background-color: white;
            color: #4a5568;
            font-size: 0.875rem;
            transition: all 0.3s ease;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23A79277'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            background-size: 1.5em 1.5em;
        }

        .sales-select:hover {
            border-color: #8B7355;
            box-shadow: 0 2px 4px rgba(167, 146, 119, 0.1);
        }

        .sales-select:focus {
            outline: none;
            ring: 2px;
            ring-color: #A79277;
            border-color: #8B7355;
        }

        .sales-chart-container {
            position: relative;
            padding: 1rem;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(8px);
            height: 400px;
        }

        .sales-info {
            position: absolute;
            top: 1rem;
            right: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            opacity: 0;
            transform: translateX(10px);
            transition: all 0.3s ease;
        }

        .sales-analytics-card:hover .sales-info {
            opacity: 1;
            transform: translateX(0);
        }

        .info-card {
            background: rgba(255, 255, 255, 0.9);
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: 1px solid rgba(167, 146, 119, 0.2);
            backdrop-filter: blur(4px);
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .info-label {
            font-size: 0.75rem;
            color: #4a5568;
        }

        .info-value {
            font-size: 1rem;
            font-weight: 600;
            color: #2d3748;
        }

        @media (max-width: 768px) {
            .sales-analytics-card {
                padding: 1rem;
            }
            
            .sales-chart-container {
                height: 300px;
            }
            
            .sales-info {
                position: static;
                flex-direction: row;
                margin-top: 1rem;
                opacity: 1;
                transform: none;
            }
            
            .info-card {
                flex: 1;
            }
        }

        /* Update the existing styles */
        .category-chart-container,
        .publisher-chart-container {
            height: 300px !important;
            padding: 0.5rem;
        }

        .category-title,
        .publisher-title {
            font-size: 1.25rem;
        }

        /* Update the chart container heights for different screen sizes */
        @media (max-width: 1024px) {
            .category-chart-container,
            .publisher-chart-container {
                height: 250px !important;
            }
        }

        @media (max-width: 768px) {
            .category-chart-container,
            .publisher-chart-container {
                height: 200px !important;
            }
            
            .category-title,
            .publisher-title {
                font-size: 1.125rem;
            }
        }
    </style>
</body>
</html>
  